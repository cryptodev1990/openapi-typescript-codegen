async function sendRequest(options: ApiRequestOptions, url: string, onCancel: (cancelHandler: () => void) => void): Promise<XMLHttpRequest> {
    const xhr = new XMLHttpRequest();
    xhr.open(options.method, url, true);
    xhr.withCredentials = OpenAPI.WITH_CREDENTIALS;

    const headers = await getHeaders(options);
    headers.forEach((value: string, key: string) => {
        xhr.setRequestHeader(key, value);
    });

    return new Promise<XMLHttpRequest>((resolve, reject) => {
        xhr.onreadystatechange = () => {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                resolve(xhr);
            }
        console.log(xhr.readyState);
            if (xhr.readyState === XMLHttpRequest.DONE) {
                reject();
            }
        };

        xhr.send(getRequestBody(options));

        onCancel(() => xhr.abort());
    });
}
