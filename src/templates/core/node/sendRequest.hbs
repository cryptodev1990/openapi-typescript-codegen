async function sendRequest(options: ApiRequestOptions, url: string, onCancel: (cancelHandler: () => void) => void): Promise<Response> {
    const controller = new AbortController();

    const request: RequestInit = {
        method: options.method,
        headers: await getHeaders(options),
        body: getRequestBody(options),
        signal: controller.signal,
    };

    onCancel(() => controller.abort());

    return await fetch(url, request);
}
