import { ApiError } from './ApiError';
import { ApiRequestOptions } from './ApiRequestOptions';
import { ApiResponse } from './ApiResponse';
import { OpenAPI } from './OpenAPI';

{{>isDefined}}

{{>isSuccess}}

{{>getQueryString}}

{{>getUrl}}

{{>catchErrors}}

{{>getFormData}}

{{>getHeaders}}

{{>getRequestBody}}

{{>getRequest}}

{{>getResponseHeader}}

{{>getResponseBody}}

/**
 * Request using XHR
 * @param options Request options
 * @result ApiResponse
 * @throws ApiError
 */
export async function request(options: ApiRequestOptions): Promise<ApiResponse> {
    const url = getUrl(options);

    return await getRequest(options.method, url, xhr => {
        const responseBody = getResponseBody(response);
        const responseHeader = getResponseHeader(response, options.responseHeader);

        const response: ApiResponse = {
            url,
            ok: isSuccess(xhr.status),
            status: xhr.status,
            statusText: xhr.statusText,
            body: responseHeader || responseBody,
        };

        catchErrors(options, response);
        return response;
    });
}
